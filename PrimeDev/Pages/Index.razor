@page "/"

@inject PrimeManager manager

<MudGrid Spacing="5" Justify="Justify.Center">
    <MudItem>
        <MudPaper Style="padding: 15pt; padding-bottom:5pt;" Class="d-flex flex-column align-center justify-center mud-width-full py-8">
               @if (!manager.IsInitialized)
                {
                    <MudText Typo="Typo.h6" Align="Align.Center">It seems you haven't connected your HP Prime Yet!</MudText>
                    <MudText Typo="Typo.subtitle1" Align="Align.Center">Click the connection button at the top right corner of this page to start the discovery and connection.</MudText>
                }
                else
                {

                       
                            <MudText Typo="Typo.h6" Align="Align.Center">Initialized!</MudText>
                            <MudText Typo="Typo.subtitle1" Align="Align.Center">Press the following button to initialize a connection test</MudText>
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="SendTest" Style="margin-top: 15pt;">Send Test!</MudButton>
                 
                     
                }
        </MudPaper>
    </MudItem>

     


    
</MudGrid>

@code{
    private PrimeCalculator prime;

    public async Task SendTest()
    {
        Console.WriteLine("Sending Test packet!");
        prime = manager.GetCalculator();
        prime.Connected += CurrentPrime_Connected;
        prime.Connect();
    }

    async void CurrentPrime_Connected(object? sender, EventArgs e)
    {
        Console.WriteLine("Prime is connected!");
        var data = new PrimeUsbData("Hello from PrimeWeb!", 32, null);
       
        await prime.Send(data);
    }

    
    protected override void OnInitialized()
    {
        manager.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        manager.OnChange -= StateHasChanged;
    }

}